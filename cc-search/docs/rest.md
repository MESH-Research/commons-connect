## REST Endpoints

/index
- GET /index - Get information about the index {auth: api_key}
- POST /index - Reset the index {auth: admin_api_key}

/documents
- GET /documents/{id} - Get document by id
- GET /documents/{id}?fields=a,b,c - Return only fields a,b,c
- POST /documents - Index new document {auth: api_key}
- POST /documents/bulk - Bulk index new documents {auth: api_key}
- PUT /documents/{id} - Update existing document {auth: api_key}
- DELETE /documents/{id} - Delete existing document {auth: api_key}
- DELETE /documents/?network_node={network_node} - Delete all documents from a network node {auth: admin_api_key}

/search
- GET /search?q={search text} - Basic search (searches all indexed fields)
- GET /search?a=x - Field a matches x exactly
- GET /search?fields=a,b,c - Return only fields a,b,c
- GET /search?search_fields=a,b,c - Search only fields a,b,c
- GET /search?username=x - Search only documents with x as a contributor
- GET /search?page=0&per_page=10 - Return 10 results per page, and show page 0 of results
- GET /search?start_date=2018-01-01&end_date=2018-12-31 - Search only documents published between 2018-01-01 and 2018-12-31
- GET /search?sort_dir={asc|desc} - Sort results in ascending|descending order
- GET /search?sort_by=a - Sort results by field a

/typeahead
- GET /typeahead?q={search text} - Typeahead search matching only title field

## Authorization

Authorization is done using a Bearer Token set in the header of the REST request. It should have the form `Authorization: Bearer 12345`. The required api_key or admin_api_key is currently a global configuration.

## Index documents

To index a document, POST to /documents with a request body of the form:

```json
{
	"_internal_id": "1234AbCD?",
	"title": "On Open Scholarship",
	"description": "An essay on the nature of open scholarship and the role of the library in supporting it.",
	"owner": {
		"name": "Reginald Gibbons",
		"username": "reginald",
		"url": "http://profiles.kcommons.org/reginald"
	},
	"contributors": [
		{
			"name": "Reginald Gibbons",
			"username": "reginald",
			"url": "http://profiles.kcommons.org/reginald",
			"role": "first author",
			"network_node": "mla"
		},
		{
			"name": "Edwina Gibbons",
			"username": "edwina",
			"url": "http://profiles.kcommons.org/edwina",
			"role": "author",
			"network_node": "hc"
		},
		{
			"name": "Obadiah Gibbons",
			"username": "obadiah"
		},
		{
			"name": "Lila Gibbons",
			"username": "lila"
		}
	],
	"primary_url": "http://works.kcommons.org/records/1234",
	"other_urls": [
		"http://works.hcommons.org/records/1234",
		"http://works.mla.kcommons.org/records/1234",
		"http://works.hastac.kcommons.org/records/1234"
	],
	"thumbnail_url": "http://works.kcommons.org/records/1234/thumbnail.png",
	"content": "This is the content of the essay. It is a long essay, and it is very interesting. It is also very well-written and well-argued and well-researched and well-documented and well-cited",
	"publication_date": "2018-01-01",
	"modified_date": "2018-01-02",
	"language": "en",
	"content_type": "deposit",
	"network_node": "works"
}
```

A successful request will return a 200 response code along with:

```json
{
    "_internal_id": "1234AbCD?",
	"_id": "2E9SqY0Bdd2QL-HGeUuA",
    "title": "On Open Scholarship",
    "primary_url": "http://works.kcommons.org/records/1234"
}
```

To bulk index documents, POST to /documents/bulk with a request body like:

```json
[
	{
		"title":  "On Open Scholarship"
		...
	},
	{
		"title": "The Art of Programming"
		...
	}
]
```

A successful indexing will return with a 200 response code and a body like:

```json
[
	{
		"_internal_id": "1234AbCD?",
		"_id": "2E9SqY0Bdd2QL-HGeUuA",
		"title": "On Open Scholarship",
		"primary_url": "http://works.kcommons.org/records/1234"
		...
	},
	{
		"_internal_id": "234jdfg3w4rerf23dsf",
		"_id": "234jdfg3w4rerf23dsf",
		"title": "The Art of Programming",
		"primary_url": "http://example.com/machine-learning"
		...
	},
]
```

The content field is omitted from the response for brevity.

Reading, updating, and deleting documents requires the `_id` field as returned by initial indexing. To update the "On Open Scholarship" document above, send a PUT request to `/documents/2E9SqY0Bdd2QL-HGeUuA` . The request body should have just the fields that require updating. Eg:

```json
{
	"title": "On Open Scholarship Volume 1"
}
```

## Document Fields

These fields apply both to indexing and searching documents:

- `_internal_id` (string) - An internal identifier for the document. This is intended to be used by the client service to track the document. It is not searchable.
- `_id` (string) - The unique identifier for the document. This is generated by the search service and is not set by the client. It is required for updating and deleting documents.
- `title` (string) - The title of the document (required)
- `description` (string) - A short description of the document
- `owner` (object) - The owner of the document (required)
	- `name` (string) - The name of the owner (required)
	- `username` (string) - The username of the owner (required)
	- `url` (string) - A URL to the owner's profile
	- `network_node` (string) - The network node of the owner (`hc`, `mla`, `hastac`, `up`, `arlisna`, `msu`, `sah`, `stemedplus` )
	- `role` (string) - The role of the owner in relation to the underlying work (eg, "first author", "author", "editor")
- `contributors` (array) - An array of contributors to the document. Each contributor is an object with the same fields as owner. **Note**: If the owner is also a contributor, they should be listed twice. To be searchable with the `username` parameter, the user must be a contributor.
- `primary_url` (string) - The primary URL of the document (required)
- `other_urls` (array) - An array of other URLs associated with the document. This is primarily used for underlying works that are accessible from multiple network nodes.
- `thumbnail_url` (string) - A URL to a thumbnail image of the document
- `content` (string) - The full content of the document
- `publication_date` (string) - The publication date of the document, in the format `YYYY-MM-DD`
- `modified_date` (string) - The date the document was last modified, in the format `YYYY-MM-DD`
- `language` (string) - The language of the document following the ISO 639-1 standard
- `content_type` (string) - The type of content. Possible values are `deposit`, `post`, `profile`, `group`, `site`, and `discussion`
- `network_node` (string) - The network node of the document (`works`, `hc`, `mla`, `hastac`, `up`, `arlisna`, `msu`, `sah`, `stemedplus` )
	

## Search Response

Search responses are formatted like so:

```json
{
	"total": 2,
	"page": 1,
	"per_page": 20,
	"request_id": "2GE9SqY0Bdd2QL-HGeUuA",
	"hits": [
		{
			"_internal_id": "1234AbCD?",
			"_id": "2E9SqY0Bdd2QL-HGeUuA",
			"title": "On Open Scholarship",
			"primary_url": "http://works.kcommons.org/records/1234",
			...
		},
		{
			"_internal_id": "234jdfg3w4rerf23dsf",
			"_id": "234jdfg3w4rerf23dsf",
			"title": "The Art of Programming",
			"primary_url": "http://example.com/machine-learning",
			...
		}
	]
}
```

- `total` (int) - The total number of results
- `page` (int) - The current page of results, indexed from 1
- `per_page` (int) - The number of results per page
- `hits` (array) - An array of search results
- `request_id` (string) - A unique identifier for the search request

## Typeahead Response

Typeahead responses are formatted like so:

```json
[
	{
		"_internal_id": "1234AbCD?",
		"title": "On Open Scholarship",
		"primary_url": "https://kcommons.org/1234",
		"other_urls": [
			"https://mla.kcommons.org/1234",
			"https://hastac.kcommons.org/1234"
		]
	},
	{
		"_internal_id": "234jdfg3w4rerf23dsf",
		"title": "The Art of Programming",
		"primary_url": "https://example.com/machine-learning",
		"other_urls": [
			"https://example.com/ai",
			"https://example.com/deep-learning"
		]
	},
	...
]
```

No other fields are returned in the typeahead response. Typeahead responses are 
limited to 5 results and are not paginated.